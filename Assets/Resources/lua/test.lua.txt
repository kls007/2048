test = test or {}
local _M = test

function _M:__init__()
    _M:InitView()
    _M:Main()
end

function _M:InitView()
    self.gameObject = UnityEngine.GameObject.Find("TestPanel").gameObject
    self.transform = self.gameObject.transform
    local transform = self.transform

    -- 自动生成
    self.Button_currentColor = self.transform:Find("$currentColor"):GetComponent("Button")
    self.Image_currentColor = self.transform:Find("$currentColor"):GetComponent("Image")
    self.pallete = {
        gameObject = transform:Find("-pallete").gameObject,
        Button_Image1 = self.transform:Find("-pallete/$Image1"):GetComponent("Button"),
        Image_Image1 = self.transform:Find("-pallete/$Image1"):GetComponent("Image"),
        Button_Image2 = self.transform:Find("-pallete/$Image2"):GetComponent("Button"),
        Image_Image2 = self.transform:Find("-pallete/$Image2"):GetComponent("Image"),
        Button_Image3 = self.transform:Find("-pallete/$Image3"):GetComponent("Button"),
        Image_Image3 = self.transform:Find("-pallete/$Image3"):GetComponent("Image"),
        Button_Image4 = self.transform:Find("-pallete/$Image4"):GetComponent("Button"),
        Image_Image4 = self.transform:Find("-pallete/$Image4"):GetComponent("Image"),
        Button_Image5 = self.transform:Find("-pallete/$Image5"):GetComponent("Button"),
        Image_Image5 = self.transform:Find("-pallete/$Image5"):GetComponent("Image"),
        Button_Image6 = self.transform:Find("-pallete/$Image6"):GetComponent("Button"),
        Image_Image6 = self.transform:Find("-pallete/$Image6"):GetComponent("Image"),
        Button_Image7 = self.transform:Find("-pallete/$Image7"):GetComponent("Button"),
        Image_Image7 = self.transform:Find("-pallete/$Image7"):GetComponent("Image"),
        Button_Image8 = self.transform:Find("-pallete/$Image8"):GetComponent("Button"),
        Image_Image8 = self.transform:Find("-pallete/$Image8"):GetComponent("Image"),
        Button_Image9 = self.transform:Find("-pallete/$Image9"):GetComponent("Button"),
        Image_Image9 = self.transform:Find("-pallete/$Image9"):GetComponent("Image"),
        Button_Image10 = self.transform:Find("-pallete/$Image10"):GetComponent("Button"),
        Image_Image10 = self.transform:Find("-pallete/$Image10"):GetComponent("Image"),
        Button_Image11 = self.transform:Find("-pallete/$Image11"):GetComponent("Button"),
        Image_Image11 = self.transform:Find("-pallete/$Image11"):GetComponent("Image")
    }
    self.pixels = {
        gameObject = transform:Find("-pixels").gameObject,
        Button_pixel = self.transform:Find("-pixels/$pixel"):GetComponent("Button"),
        Image_pixel = self.transform:Find("-pixels/$pixel"):GetComponent("Image")
    }
    -- 自动生成

    self.buttonList = {
        self.pallete.Button_Image1,
        self.pallete.Button_Image2,
        self.pallete.Button_Image3,
        self.pallete.Button_Image4,
        self.pallete.Button_Image5,
        self.pallete.Button_Image6,
        self.pallete.Button_Image7,
        self.pallete.Button_Image8,
        self.pallete.Button_Image9,
        self.pallete.Button_Image10,
        self.pallete.Button_Image11,
    }
end

function _M:Main()
    self:AddListener()
    self:Start()
end

function _M:AddListener()
    for index, value in ipairs(self.buttonList) do
        UnityEngine.EventTriggerListener.Get(value.gameObject, nil).onClick = function()
            -- print(index)

            local clickButtonImage = value.gameObject:GetComponent("Image")
            self.Image_currentColor.color = clickButtonImage.color
        end
    end
end

function _M:DrawColor(gameObject)
    local clickButtonImage = gameObject:GetComponent("Image")
    clickButtonImage.color = self.Image_currentColor.color
end

function _M:Start()
    self.row = 15
    self.col = 15
    self.width = 60
    self.space = 2
    self.list = {}
    for y = 1, self.row, 1 do
        self.list[y] = {}
        for x = 1, self.col, 1 do
            self.list[y][x] = 0
        end
    end

    local parent = self.pixels.gameObject.transform
    local prefab = parent.transform:GetChild(0).gameObject
    functions.SetActiveAllChildren(parent, false)
    for y = 1, self.row, 1 do
        self.list[y] = {}
        for x = 1, self.col, 1 do
            local gameObject = functions.GetGo(parent, prefab)
            self.list[y][x] = gameObject
            gameObject.name = y .. "_" .. x
            gameObject:GetComponent("RectTransform").sizeDelta = CS.UnityEngine.Vector2(self.width, self.width)
            gameObject.transform.localPosition = CS.UnityEngine.Vector3(x * (self.width + self.space) - 560, y * (self.width + self.space) - 700, 0)
            
            
            UnityEngine.EventTriggerListener.Get(gameObject, nil).onDown = function()
                self.isDown = true
                self:DrawColor(gameObject)
            end
            UnityEngine.EventTriggerListener.Get(gameObject, nil).onUp = function()
                self.isDown = false
            end
            UnityEngine.EventTriggerListener.Get(gameObject, nil).onEnter = function()
                if self.isDown == true then
                    self:DrawColor(gameObject)
                end
            end
        end
    end

end

_M:__init__()
